use crate::orderbook::{
    Level,
    Operation,
    Source,
};
use futures_util::{
    SinkExt,
    StreamExt,
};
use serde_derive::{
    Deserialize,
    Serialize,
};
use std::num::ParseFloatError;
use tokio::{
    io::AsyncWriteExt,
    sync::mpsc::UnboundedSender,
};
use tokio_tungstenite::{
    connect_async,
    tungstenite::Message,
};
use url::Url;

pub enum DeribitError {
    AskPriceParse(ParseFloatError),
    AskSizeParse(ParseFloatError),
    BidPriceParse(ParseFloatError),
    BidSizeParse(ParseFloatError),
    UrlParse(url::ParseError),
    WSConnect(tokio_tungstenite::tungstenite::Error),
    WSSend(tokio_tungstenite::tungstenite::Error),
}

/*
{"jsonrpc":"2.0","method":"subscription","params":{"channel":"book.BTC-PERPETUAL.100ms","data":{"type":"snapshot","timestamp":1659142225882,"instrument_name":"BTC-PERPETUAL","change_id":48177633129,"bids":[["new",23920.0,2260.0],["new",23919.5,1400.0],["new",23919.0,510.0],["new",23918.5,9510.0],["new",23918.0,4000.0],["new",23917.5,1240.0],["new",23917.0,500.0],["new",23916.5,14430.0],["new",23915.5,980.0],["new",23915.0,23410.0],["new",23914.5,16740.0],["new",23914.0,51860.0],["new",23913.5,28700.0],["new",23913.0,17500.0],["new",23912.5,104110.0],["new",23911.0,110.0],["new",23910.5,590.0],["new",23910.0,10140.0],["new",23907.5,2000.0],["new",23907.0,186000.0],["new",23906.5,100.0],["new",23905.5,35000.0],["new",23904.5,13000.0],["new",23904.0,8010.0],["new",23903.5,3010.0],["new",23903.0,10.0],["new",23901.5,3530.0],["new",23901.0,96750.0],["new",23900.5,11950.0],["new",23900.0,54000.0],["new",23899.5,480.0],["new",23898.5,1210.0],["new",23898.0,14340.0],["new",23895.5,50740.0],["new",23895.0,3500.0],["new",23894.0,2000.0],["new",23893.5,53890.0],["new",23891.5,1480.0],["new",23891.0,730.0],["new",23890.0,2140.0],["new",23889.5,34720.0],["new",23889.0,14570.0],["new",23888.0,394370.0],["new",23887.5,445360.0],["new",23886.5,13720.0],["new",23886.0,10.0],["new",23885.5,10.0],["new",23885.0,20.0],["new",23884.5,39490.0],["new",23884.0,3520.0],["new",23883.0,10.0],["new",23882.5,10.0],["new",23882.0,3840.0],["new",23881.5,600020.0],["new",23881.0,2020.0],["new",23880.5,500.0],["new",23880.0,40.0],["new",23879.5,20.0],["new",23879.0,40.0],["new",23878.0,20.0],["new",23877.5,30.0],["new",23877.0,40.0],["new",23876.5,60.0],["new",23876.0,120.0],["new",23875.5,530.0],["new",23874.5,10.0],["new",23873.0,27710.0],["new",23872.5,30.0],["new",23872.0,20.0],["new",23871.5,50.0],["new",23871.0,38490.0],["new",23870.5,102110.0],["new",23870.0,30.0],["new",23869.5,1020.0],["new",23869.0,91020.0],["new",23868.0,10.0],["new",23865.5,30.0],["new",23865.0,97730.0],["new",23864.5,40.0],["new",23864.0,38980.0],["new",23863.5,20.0],["new",23863.0,140590.0],["new",23862.0,20.0],["new",23861.5,16670.0],["new",23861.0,13720.0],["new",23860.5,480.0],["new",23857.5,271740.0],["new",23853.5,98270.0],["new",23852.0,21500.0],["new",23850.0,7180.0],["new",23849.5,480.0],["new",23848.5,277070.0],["new",23847.5,138030.0],["new",23842.5,480.0],["new",23842.0,480.0],["new",23841.5,480.0],["new",23841.0,13720.0],["new",23840.5,378270.0],["new",23838.5,1500.0],["new",23835.5,355500.0],["new",23832.0,2480.0],["new",23830.0,1500.0],["new",23829.0,1500.0],["new",23824.5,490.0],["new",23824.0,480.0],["new",23823.5,480.0],["new",23822.0,13720.0],["new",23820.0,48050.0],["new",23819.0,10.0],["new",23816.0,207740.0],["new",23813.0,7140.0],["new",23810.0,7420.0],["new",23804.0,118790.0],["new",23800.0,10.0],["new",23796.0,205060.0],["new",23792.5,13720.0],["new",23791.0,1000000.0],["new",23788.0,2470.0],["new",23782.5,10.0],["new",23780.0,190.0],["new",23777.0,410.0],["new",23770.0,16740.0],["new",23768.0,118790.0],["new",23765.5,13720.0],["new",23759.0,40.0],["new",23757.0,38490.0],["new",23755.0,240.0],["new",23748.5,346470.0],["new",23745.5,10.0],["new",23736.0,520.0],["new",23732.0,2960.0],["new",23730.0,9560.0],["new",23723.0,20.0],["new",23722.5,118790.0],["new",23722.0,5930.0],["new",23719.0,20.0],["new",23716.0,20.0],["new",23714.5,20.0],["new",23711.0,20.0],["new",23707.0,30.0],["new",23705.5,5930.0],["new",23705.0,118790.0],["new",23702.5,20.0],["new",23700.0,980.0],["new",23699.0,20.0],["new",23695.0,4520.0],["new",23693.0,20.0],["new",23690.5,20.0],["new",23690.0,4500.0],["new",23688.5,5930.0],["new",23688.0,2550.0],["new",23686.5,30.0],["new",23685.0,304500.0],["new",23680.0,2000.0],["new",23677.0,10.0],["new",23674.5,10.0],["new",23672.0,5930.0],["new",23671.5,100.0],["new",23670.0,7180.0],["new",23665.0,20.0],["new",23660.5,180.0],["new",23660.0,180.0],["new",23659.0,38490.0],["new",23656.5,138970.0],["new",23655.5,30.0],["new",23655.0,124720.0],["new",23650.0,610.0],["new",23645.0,240.0],["new",23643.5,120.0],["new",23638.5,5930.0],["new",23637.0,20.0],["new",23634.5,10000.0],["new",23633.0,10.0],["new",23632.0,2430.0],["new",23625.0,10000.0],["new",23622.0,5930.0],["new",23620.0,5000.0],["new",23616.0,56000.0],["new",23614.0,300030.0],["new",23611.0,10.0],["new",23610.0,115480.0],["new",23606.5,10.0],["new",23606.0,5930.0],["new",23605.0,118790.0],["new",23600.0,200.0],["new",23598.0,9620.0],["new",23596.0,10.0],["new",23595.0,2000.0],["new",23594.5,600.0],["new",23590.0,370.0],["new",23589.5,5930.0],["new",23588.5,2000.0],["new",23588.0,2410.0],["new",23582.0,2000.0],["new",23581.5,60.0],["new",23577.5,230.0],["new",23575.5,4000.0],["new",23573.0,5930.0],["new",23571.0,250.0],["new",23569.0,2000.0],["new",23567.5,140.0],["new",23566.0,10.0],["new",23562.5,282780.0],["new",23562.0,10.0],["new",23556.5,100.0],["new",23556.0,14000.0],["new",23553.0,500.0],["new",23550.0,41340.0],["new",23549.5,2000.0],["new",23543.0,4000.0],["new",23540.5,127530.0],["new",23540.0,180.0],["new",23537.0,70.0],["new",23536.5,4000.0],["new",23536.0,610.0],["new",23535.0,240.0],["new",23534.0,1000.0],["new",23532.0,2420.0],["new",23531.0,100.0],["new",23530.0,2000.0],["new",23527.0,10000.0],["new",23525.5,10.0],["new",23523.5,4000.0],["new",23519.5,130.0],["new",23517.0,2000.0],["new",23510.5,2000.0],["new",23504.0,4000.0],["new",23503.0,10.0],["new",23500.0,140.0],["new",23497.5,2000.0],["new",23492.0,1000.0],["new",23491.0,2000.0],["new",23490.0,7770.0],["new",23489.0,10.0],["new",23488.0,2400.0],["new",23486.5,250.0],["new",23485.0,1000.0],["new",23484.5,2000.0],["new",23484.0,740.0],["new",23480.0,7780.0],["new",23478.0,3000.0],["new",23471.5,4000.0],["new",23471.0,1000.0],["new",23470.0,7780.0],["new",23469.0,600.0],["new",23466.0,10.0],["new",23465.0,2000.0],["new",23464.0,2000.0],["new",23460.0,15540.0],["new",23458.5,4000.0],["new",23452.0,4000.0],["new",23450.0,7770.0],["new",23446.5,10000.0],["new",23445.5,2000.0],["new",23443.0,1000.0],["new",23440.0,8010.0],["new",23434.0,1000.0],["new",23433.5,130.0],["new",23433.0,500.0],["new",23432.5,2000.0],["new",23432.0,2370.0],["new",23430.0,15540.0],["new",23429.0,1000.0],["new",23424.0,3550.0],["new",23422.5,70810.0],["new",23422.0,1000.0],["new",23420.0,7950.0],["new",23413.5,100.0],["new",23413.0,2000.0],["new",23410.0,7770.0],["new",23408.0,2000.0],["new",23406.0,10.0],["new",23405.0,10000.0],["new",23400.0,2800.0],["new",23394.0,1000.0],["new",23393.0,10.0],["new",23390.0,7770.0],["new",23388.0,2390.0],["new",23387.0,2000.0],["new",23385.0,240.0],["new",23380.5,2000.0],["new",23380.0,185430.0],["new",23374.0,2000.0],["new",23370.0,7770.0],["new",23367.5,2000.0],["new",23366.0,1000.0],["new",23362.0,10.0],["new",23359.0,132100.0],["new",23352.0,1000.0],["new",23350.0,15540.0],["new",23346.0,501000.0],["new",23341.5,2000.0],["new",23340.0,7770.0],["new",23335.0,2000.0],["new",23333.0,500.0],["new",23332.0,2410.0],["new",23331.0,1000.0],["new",23330.0,15780.0],["new",23325.0,5000.0],["new",23324.0,1000.0],["new",23320.0,10000.0],["new",23315.5,2000.0],["new",23315.0,10000.0],["new",23311.0,600.0],["new",23310.0,7770.0],["new",23309.0,2000.0],["new",23302.0,200.0],["new",23300.0,4668090.0],["new",23296.0,500000.0],["new",23290.0,7770.0],["new",23275.0,240.0],["new",23265.0,13100.0],["new",23260.0,8970.0],["new",23256.0,500.0],["new",23252.5,10.0],["new",23250.0,7770.0],["new",23246.5,100.0],["new",23246.0,500000.0],["new",23244.5,35880.0],["new",23244.0,200.0],["new",23236.0,20.0],["new",23233.0,2320.0],["new",23232.0,2350.0],["new",23231.0,100.0],["new",23227.0,10000.0],["new",23220.0,240.0],["new",23218.5,193790.0],["new",23217.0,10000.0],["new",23210.5,10.0],["new",23210.0,15540.0],["new",23207.5,23700.0],["new",23201.0,10.0],["new",23200.0,1830.0],["new",23192.0,1000.0],["new",23191.5,23700.0],["new",23187.5,23710.0],["new",23180.0,180.0],["new",23174.5,180.0],["new",23171.5,23710.0],["new",23170.0,2800.0],["new",23165.0,240.0],["new",23160.0,15540.0],["new",23156.0,500.0],["new",23155.0,23710.0],["new",23150.0,200.0],["new",23143.5,10.0],["new",23141.0,199300.0],["new",23140.0,20.0],["new",23139.0,23720.0],["new",23132.0,2340.0],["new",23127.0,11000.0],["new",23123.0,23710.0],["new",23120.0,19770.0],["new",23111.0,100000.0],["new",23110.0,8010.0],["new",23103.0,30.0],["new",23100.0,3465760.0],["new",23096.0,23700.0],["new",23093.5,20000.0],["new",23092.0,12000.0],["new",23090.5,23710.0],["new",23082.0,1680.0],["new",23078.5,10.0],["new",23075.5,23710.0],["new",23068.5,240.0],["new",23060.0,7950.0],["new",23057.0,10010.0],["new",23056.0,500.0],["new",23055.5,100.0],["new",23055.0,240.0],["new",23050.0,2305000.0],["new",23032.5,10.0],["new",23032.0,2330.0],["new",23027.0,10000.0],["new",23020.0,3500.0],["new",23010.0,10.0],["new",23006.0,500.0],["new",23003.0,20.0],["new",23001.0,150.0],["new",23000.0,21160.0],["new",22995.0,5000.0],["new",22962.0,20.0],["new",22949.0,100.0],["new",22946.5,250.0],["new",22945.0,240.0],["new",22940.0,7950.0],["new",22934.5,10.0],["new",22933.0,500.0],["new",22922.0,2320.0],["new",22921.0,10000.0],["new",22917.0,1000.0],["new",22911.0,11630.0],["new",22909.0,10.0],["new",22900.0,1740.0],["new",22896.0,10.0],["new",22890.0,240.0],["new",22870.0,7770.0],["new",22865.0,50000.0],["new",22864.0,10.0],["new",22858.5,25000.0],["new",22857.0,10000.0],["new",22851.0,250.0],["new",22840.5,100.0],["new",22840.0,3000.0],["new",22835.5,400.0],["new",22835.0,240.0],["new",22833.0,500.0],["new",22822.0,2310.0],["new",22820.0,180.0],["new",22810.0,7770.0],["new",22800.0,640.0],["new",22794.0,14360.0],["new",22780.0,260.0],["new",22778.5,10.0],["new",22771.0,100000.0],["new",22757.0,10000.0],["new",22755.0,100.0],["new",22750.0,23310.0],["new",22743.0,1000.0],["new",22740.0,15540.0],["new",22738.5,250.0],["new",22738.0,7770.0],["new",22736.0,1000.0],["new",22733.0,500.0],["new",22729.0,1000.0],["new",22725.5,1000.0],["new",22725.0,240.0],["new",22722.0,4300.0],["new",22720.0,15540.0],["new",22718.0,7770.0],["new",22715.0,1000.0],["new",22714.5,10.0],["new",22710.0,7770.0],["new",22704.5,250.0],["new",22701.0,2000.0],["new",22700.0,2305920.0],["new",22699.5,1000.0],["new",22694.0,1000.0],["new",22691.0,50.0],["new",22690.0,15540.0],["new",22687.0,1000.0],["new",22680.0,8770.0],["new",22673.0,1000.0],["new",22670.0,15780.0],["new",22666.0,11110.0],["new",22659.0,1000.0],["new",22657.0,13100.0],["new",22655.0,2000.0],["new",22650.0,15550.0],["new",22645.0,1000.0],["new",22640.0,7770.0],["new",22633.0,500.0],["new",22631.0,1000.0],["new",22630.0,7770.0],["new",22627.0,10000.0],["new",22624.0,2000.0],["new",22622.0,2290.0],["new",22621.5,14360.0],["new",22615.0,240.0],["new",22614.0,3360.0],["new",22610.0,8270.0],["new",22605.0,55970.0],["new",22603.0,1000.0],["new",22601.5,100.0],["new",22600.0,12120.0],["new",22598.0,20000.0],["new",22589.0,1000.0],["new",22585.0,7770.0],["new",22582.0,2000.0],["new",22580.0,7770.0],["new",22575.5,10.0],["new",22575.0,100000.0],["new",22568.0,1000.0],["new",22561.0,100.0],["new",22560.0,23550.0],["new",22555.0,100.0],["new",22554.0,1000.0],["new",22550.0,7770.0],["new",22547.0,1000.0],["new",22543.0,25000.0],["new",22540.0,24310.0],["new",22535.0,7770.0],["new",22534.5,5000.0],["new",22533.0,1000.0],["new",22526.0,10.0],["new",22524.0,30.0],["new",22522.0,2430.0],["new",22520.0,15540.0],["new",22519.0,1020.0],["new",22518.0,20.0],["new",22516.0,10.0],["new",22515.0,23410.0],["new",22512.5,500.0],["new",22512.0,1000.0],["new",22510.0,23310.0],["new",22506.0,10.0],["new",22505.0,32920.0],["new",22500.0,38200.0],["new",22499.0,250.0],["new",22498.0,1000.0],["new",22496.0,20.0],["new",22495.0,7770.0],["new",22493.5,480.0],["new",22490.0,1000.0],["new",22484.0,1000.0],["new",22480.0,15540.0],["new",22479.0,14400.0],["new",22478.0,5000.0],["new",22470.0,8770.0],["new",22463.0,1020.0],["new",22460.0,7770.0],["new",22456.0,1000.0],["new",22450.0,8010.0],["new",22449.5,11000.0],["new",22442.0,1000.0],["new",22440.0,15540.0],["new",22437.5,20.0],["new",22436.0,20.0],["new",22428.0,1000.0],["new",22422.0,2270.0],["new",22421.0,2000.0],["new",22420.0,7770.0],["new",22415.0,100.0],["new",22410.5,10.0],["new",22410.0,7770.0],["new",22407.0,1000.0],["new",22406.0,600000.0],["new",22403.5,230.0],["new",22403.0,20.0],["new",22401.5,600.0],["new",22400.0,1127810.0],["new",22396.0,16000.0],["new",22386.0,20.0],["new",22369.0,20.0],["new",22347.0,700000.0],["new",22346.0,20.0],["new",22338.5,100.0],["new",22336.0,20.0],["new",22322.0,2260.0],["new",22319.0,20.0],["new",22315.0,100.0],["new",22313.5,14380.0],["new",22306.5,850.0],["new",22300.0,46000.0],["new",22298.0,1400.0],["new",22296.0,20.0],["new",22290.0,21000.0],["new",22280.0,21000.0],["new",22277.5,1000.0],["new",22273.5,1000.0],["new",22272.0,900000.0],["new",22270.0,21000.0],["new",22269.0,20.0],["new",22267.0,3000.0],["new",22260.0,21000.0],["new",22255.0,500000.0],["new",22252.5,10.0],["new",22250.0,21000.0],["new",22240.0,21000.0],["new",22239.0,20.0],["new",22230.0,21000.0],["new",22222.0,702250.0],["new",22220.0,21000.0],["new",22216.0,20.0],["new",22215.0,100.0],["new",22210.0,21000.0],["new",22203.5,600.0],["new",22200.0,21200.0],["new",22196.0,20.0],["new",22187.0,3100.0],["new",22169.0,20.0],["new",22167.0,10.0],["new",22161.0,100.0],["new",22160.5,25000.0],["new",22152.5,14380.0],["new",22149.5,20.0],["new",22136.0,20.0],["new",22122.0,2240.0],["new",22115.0,100.0],["new",22103.0,20.0],["new",22101.0,600.0],["new",22100.0,10140.0],["new",22087.0,1000.0],["new",22085.5,1000.0],["new",22070.0,20000.0],["new",22052.0,100.0],["new",22050.0,500.0],["new",22037.0,10.0],["new",22022.0,2230.0],["new",22010.0,35000.0],["new",22007.5,600.0],["new",22001.0,150.0],["new",22000.0,2200350.0],["new",21996.5,14380.0],["new",21971.0,1100000.0],["new",21953.5,1000.0],["new",21927.5,10.0],["new",21912.0,2220.0],["new",21911.0,200000.0],["new",21906.0,600.0],["new",21900.0,140.0],["new",21890.0,10.0],["new",21880.0,10.0],["new",21861.0,100.0],["new",21841.5,14380.0],["new",21833.0,22000.0],["new",21830.0,20000.0],["new",21812.0,2210.0],["new",21804.5,600.0],["new",21800.0,200.0],["new",21780.0,20.0],["new",21741.5,100.0],["new",21738.0,25000.0],["new",21712.0,2200.0],["new",21700.0,15120.0],["new",21630.0,20000.0],["new",21612.0,2190.0],["new",21607.0,30.0],["new",21604.5,30.0],["new",21600.0,2160640.0],["new",21567.0,10.0],["new",21560.5,10.0],["new",21552.5,5000.0],["new",21552.0,10560.0],["new",21540.0,20.0],["new",21529.5,14360.0],["new",21518.0,150.0],["new",21516.0,20.0],["new",21512.0,2180.0],["new",21509.0,400.0],["new",21505.0,500.0],["new",21500.0,6680.0],["new",21458.5,25000.0],["new",21455.0,10.0],["new",21430.0,20000.0],["new",21425.5,20.0],["new",21425.0,14380.0],["new",21411.0,2170.0],["new",21407.0,100.0],["new",21403.5,50.0],["new",21400.0,600.0],["new",21396.5,25000.0],["new",21371.0,4550.0],["new",21300.0,800.0],["new",21280.0,10.0],["new",21262.0,2510.0],["new",21261.0,100.0],["new",21248.0,20.0],["new",21230.0,20000.0],["new",21200.0,11440.0],["new",21186.0,20000.0],["new",21173.5,500.0],["new",21171.0,10.0],["new",21138.0,2140.0],["new",21131.5,2000.0],["new",21102.0,25000.0],["new",21100.0,800.0],["new",21050.0,500.0],["new",21036.5,100.0],["new",21030.0,20000.0],["new",21012.0,2120.0],["new",21004.0,600.0],["new",21001.0,150.0],["new",21000.0,2180.0],["new",20961.0,100.0],["new",20901.0,8000.0],["new",20900.0,1790.0],["new",20874.0,5000.0],["new",20850.0,20850.0],["new",20830.0,70000.0],["new",20820.0,10.0],["new",20800.0,2082950.0],["new",20781.0,25000.0],["new",20778.0,390.0],["new",20777.0,200.0],["new",20731.0,10.0],["new",20719.0,1000.0],["new",20711.0,18630.0],["new",20700.0,1000.0],["new",20661.0,100.0],["new",20630.0,100.0],["new",20611.0,21000.0],["new",20600.0,1250.0],["new",20550.0,10000.0],["new",20537.0,20.0],["new",20511.0,21000.0],["new",20502.0,2090.0],["new",20500.0,10940.0],["new",20460.0,10.0],["new",20411.0,21000.0],["new",20400.0,1800.0],["new",20390.0,30.0],["new",20311.0,21000.0],["new",20300.0,800.0],["new",20294.0,20.0],["new",20282.0,3500.0],["new",20267.0,10000.0],["new",20255.0,2500.0],["new",20246.5,25000.0],["new",20221.5,8000.0],["new",20211.0,21000.0],["new",20200.0,800.0],["new",20188.0,100.0],["new",20178.5,2020.0],["new",20167.0,10.0],["new",20150.0,20000.0],["new",20111.0,21000.0],["new",20100.0,830.0],["new",20090.0,500.0],["new",20083.0,3000.0],["new",20070.0,50.0],["new",20055.0,1002750.0],["new",20050.0,3800.0],["new",20020.0,1000.0],["new",20011.0,21020.0],["new",20001.0,150.0],["new",20000.0,4400.0],["new",19994.5,50.0],["new",19961.0,3500.0],["new",19950.0,220.0],["new",19911.0,21020.0],["new",19900.0,390.0],["new",19888.0,2010.0],["new",19870.0,10000.0],["new",19850.0,200.0],["new",19811.0,21020.0],["new",19808.0,20.0],["new",19800.0,680.0],["new",19796.0,500000.0],["new",19784.0,5900.0],["new",19773.0,20000.0],["new",19771.0,10.0],["new",19757.0,10000.0],["new",19750.0,10200.0],["new",19746.5,100.0],["new",19746.0,500000.0],["new",19719.0,20.0],["new",19711.0,21020.0],["new",19710.0,100.0],["new",19700.0,250.0],["new",19696.0,500000.0],["new",19678.0,10000.0],["new",19650.0,200.0],["new",19646.0,500000.0],["new",19640.0,3010.0],["new",19630.0,1000.0],["new",19611.0,21020.0],["new",19600.0,240.0],["new",19589.0,21000.0],["new",19588.0,250.0],["new",19580.0,500.0],["new",19578.0,10000.0],["new",19571.0,1970.0],["new",19558.5,20.0],["new",19556.0,630.0],["new",19548.0,2000.0],["new",19511.0,21020.0],["new",19500.0,400.0],["new",19465.5,3000.0],["new",19424.0,10.0],["new",19411.0,21020.0],["new",19400.0,400.0],["new",19387.5,50.0],["new",19333.0,30.0],["new",19319.0,2000.0],["new",19311.0,21020.0],["new",19301.0,10.0],["new",19300.0,200.0],["new",19242.0,10.0],["new",19211.0,21020.0],["new",19200.0,600.0],["new",19188.0,30.0],["new",19111.0,21020.0],["new",19101.0,10.0],["new",19100.0,400.0],["new",19033.0,500.0],["new",19020.0,2010.0],["new",19011.0,21020.0],["new",19001.0,150.0],["new",19000.0,51800.0],["new",18998.0,2000.0],["new",18960.5,100.0],["new",18914.5,150.0],["new",18911.0,21020.0],["new",18907.0,3000.0],["new",18900.0,5200.0],["new",18887.0,1920.0],["new",18816.0,940.0],["new",18800.0,21800.0],["new",18703.0,100.0],["new",18700.0,21100.0],["new",18666.0,50.0],["new",18616.0,930.0],["new",18600.0,58300.0],["new",18599.5,100.0],["new",18594.5,3700.0],["new",18571.0,1870.0],["new",18550.0,18550.0],["new",18500.0,29450.0],["new",18476.5,10.0],["new",18444.0,50.0],["new",18416.0,920.0],["new",18400.0,22800.0],["new",18366.0,100.0],["new",18334.0,2920.0],["new",18333.0,10.0],["new",18323.5,2500.0],["new",18300.0,32200.0],["new",18282.0,10.0],["new",18250.0,1000.0],["new",18238.5,100.0],["new",18222.0,50.0],["new",18216.0,910.0],["new",18202.0,1820.0],["new",18200.0,21300.0],["new",18125.0,500.0],["new",18120.0,1000.0],["new",18115.0,10.0],["new",18108.0,20.0],["new",18100.0,44470.0],["new",18099.5,10.0],["new",18088.0,9050.0],["new",18071.0,1820.0],["new",18062.0,20.0],["new",18061.0,5000.0],["new",18016.0,900.0],["new",18001.0,100.0],["new",18000.0,47990.0],["new",17944.0,100.0],["new",17933.5,10.0],["new",17900.0,44900.0],["new",17888.0,1050.0],["new",17863.0,38000.0],["new",17832.0,400.0],["new",17818.0,200.0],["new",17816.0,890.0],["new",17800.0,74500.0],["new",17775.5,100.0],["new",17756.5,10.0],["new",17750.0,10000.0],["new",17716.0,900.0],["new",17700.0,20400.0],["new",17694.0,10000.0],["new",17675.0,10.0],["new",17616.0,880.0],["new",17600.0,21100.0],["new",17582.5,10.0],["new",17571.0,1770.0],["new",17564.0,100.0],["new",17555.0,50.0],["new",17500.0,1000.0],["new",17456.0,50000.0],["new",17400.0,1500.0],["new",17389.5,100.0],["new",17333.0,50.0],["new",17300.0,200.0],["new",17256.0,50000.0],["new",17236.0,250000.0],["new",17219.5,200.0],["new",17200.0,1000.0],["new",17199.0,20.0],["new",17111.0,50.0],["new",17097.0,100.0],["new",17091.0,100.0],["new",17075.0,10.0],["new",17056.0,50000.0],["new",17010.0,300.0],["new",17001.0,50.0],["new",17000.0,511200.0],["new",16856.0,50000.0],["new",16724.5,150.0],["new",16714.5,16000.0],["new",16700.0,100.0],["new",16688.0,250.0],["new",16656.0,50000.0],["new",16612.0,150.0],["new",16507.0,20000.0],["new",16500.5,50.0],["new",16500.0,2100.0],["new",16456.0,50000.0],["new",16432.0,100.0],["new",16412.0,100.0],["new",16400.0,1500.0],["new",16375.0,10.0],["new",16373.0,700.0],["new",16338.0,100.0],["new",16333.0,10.0],["new",16300.0,640.0],["new",16299.0,30.0],["new",16256.0,50000.0],["new",16250.0,105000.0],["new",16236.0,250000.0],["new",16213.0,4860.0],["new",16200.0,16200.0],["new",16071.5,1000.0],["new",16069.0,2600.0],["new",16068.0,7500.0],["new",16056.0,50000.0],["new",16010.0,500.0],["new",16000.0,152200.0],["new",15999.0,72000.0],["new",15947.0,50.0],["new",15908.5,50.0],["new",15900.0,100.0],["new",15889.0,3310.0],["new",15856.0,50000.0],["new",15826.0,50.0],["new",15800.0,2500.0],["new",15789.5,50.0],["new",15787.5,12000.0],["new",15771.5,700.0],["new",15723.0,120980.0],["new",15714.5,50.0],["new",15672.0,78360.0],["new",15664.5,10.0],["new",15656.0,50000.0],["new",15616.0,50.0],["new",15612.0,150.0],["new",15600.0,1560.0],["new",15555.0,5010.0],["new",15550.5,50.0],["new",15517.0,100.0],["new",15510.0,500.0],["new",15500.5,50.0],["new",15500.0,2000.0],["new",15495.0,1000.0],["new",15456.0,50000.0],["new",15345.5,50.0],["new",15256.0,50000.0],["new",15250.0,105000.0],["new",15239.5,20.0],["new",15236.0,250000.0],["new",15220.0,100.0],["new",15110.0,25000.0],["new",15060.0,92500.0],["new",15056.0,50000.0],["new",15012.0,10.0],["new",15010.0,500.0],["new",15000.0,32620.0],["new",14991.5,20.0],["new",14900.0,100.0],["new",14888.0,150.0],["new",14856.0,50000.0],["new",14818.5,50000.0],["new",14656.0,50000.0],["new",14510.0,500.0],["new",14500.0,100.0],["new",14456.0,50000.0],["new",14384.5,20.0],["new",14364.5,100.0],["new",14300.0,650.0],["new",14256.0,50000.0],["new",14250.0,105000.0],["new",14236.0,250000.0],["new",14157.0,500.0],["new",14141.0,100000.0],["new",14112.0,2500.0],["new",14078.0,20.0],["new",14068.0,100.0],["new",14056.0,50000.0],["new",14001.0,200.0],["new",14000.0,607160.0],["new",13932.0,13930.0],["new",13910.5,2000.0],["new",13900.0,50650.0],["new",13866.0,3000.0],["new",13861.5,60000.0],["new",13856.0,50000.0],["new",13794.5,20.0],["new",13745.5,100.0],["new",13715.5,20.0],["new",13656.0,50000.0],["new",13620.0,20.0],["new",13619.5,20.0],["new",13613.5,20.0],["new",13606.5,20.0],["new",13600.0,20.0],["new",13598.5,20.0],["new",13594.5,20.0],["new",13586.0,20.0],["new",13573.5,20.0],["new",13564.0,20.0],["new",13551.0,20.0],["new",13543.5,50.0],["new",13541.0,20.0],["new",13530.0,20.0],["new",13501.5,20.0],["new",13501.0,10.0],["new",13491.0,10000.0],["new",13489.0,50.0],["new",13483.5,20.0],["new",13470.0,50.0],["new",13466.5,20.0],["new",13456.5,50.0],["new",13456.0,50000.0],["new",13449.0,20.0],["new",13448.0,50.0],["new",13423.5,20.0],["new",13402.5,20.0],["new",13379.0,50.0],["new",13367.0,30.0],["new",13360.0,35000.0],["new",13344.0,20.0],["new",13330.0,70000.0],["new",13290.0,20.0],["new",13284.5,100.0],["new",13280.5,20.0],["new",13256.0,50000.0],["new",13255.0,100000.0],["new",13250.0,255000.0],["new",13248.0,3000.0],["new",13244.5,20.0],["new",13221.5,20.0],["new",13215.0,20.0],["new",13144.0,20.0],["new",13140.0,100.0],["new",13081.5,20.0],["new",13056.0,50000.0],["new",13000.0,320.0],["new",12991.0,20.0],["new",12949.0,50.0],["new",12938.0,20.0],["new",12863.0,100.0],["new",12856.0,50000.0],["new",12800.0,3840.0],["new",12747.0,100.0],["new",12672.0,63360.0],["new",12656.0,50000.0],["new",12555.0,10.0],["new",12553.5,690.0],["new",12500.0,140050.0],["new",12456.0,50000.0],["new",12273.0,200.0],["new",12256.0,50000.0],["new",12056.0,50000.0],["new",12007.0,50.0],["new",12000.0,430110.0],["new",11961.5,40.0],["new",11917.0,100.0],["new",11856.0,50000.0],["new",11766.5,50.0],["new",11710.0,11710.0],["new",11656.0,50000.0],["new",11580.0,20.0],["new",11566.0,100.0],["new",11500.0,116150.0],["new",11456.0,50000.0],["new",11360.0,20.0],["new",11285.5,50.0],["new",11256.0,50000.0],["new",11245.0,100.0],["new",11225.0,10.0],["new",11204.0,5290.0],["new",11111.0,120000.0],["new",11100.0,4710.0],["new",11056.0,50000.0],["new",11038.0,20.0],["new",11000.0,116080.0],["new",10955.0,200.0],["new",10905.0,100.0],["new",10856.0,50000.0],["new",10842.0,20.0],["new",10700.0,53500.0],["new",10656.0,50000.0],["new",10650.0,100.0],["new",10595.0,100.0],["new",10564.5,20.0],["new",10555.0,10.0],["new",10523.5,50.0],["new",10459.5,20.0],["new",10456.0,50000.0],["new",10450.0,100.0],["new",10427.0,100.0],["new",10317.0,200.0],["new",10310.5,20.0],["new",10291.0,20.0],["new",10256.0,50000.0],["new",10250.0,100.0],["new",10225.0,100.0],["new",10096.0,20.0],["new",10056.0,50000.0],["new",10050.0,10150.0],["new",10000.0,20340.0],["new",9999.0,50000.0],["new",9946.5,20.0],["new",9910.5,50.0],["new",9850.0,100.0],["new",9768.5,20.0],["new",9765.0,10.0],["new",9739.5,100.0],["new",9694.5,20.0],["new",9687.5,10.0],["new",9679.0,200.0],["new",9650.0,180.0],["new",9460.0,100.0],["new",9450.0,200.0],["new",9439.5,20.0],["new",9380.0,100.0],["new",9350.0,100.0],["new",9250.0,100.0],["new",9222.5,20.0],["new",9201.5,10.0],["new",9170.5,20.0],["new",9150.0,100.0],["new",9083.5,20.0],["new",9050.0,200.0],["new",9021.0,10000.0],["new",9020.0,10.0],["new",9000.0,60.0],["new",8950.0,100.0],["new",8907.0,20.0],["new",8888.0,106660.0],["new",8800.0,10.0],["new",8689.5,20.0],["new",8537.0,20.0],["new",8535.5,10.0],["new",8521.5,40.0],["new",8430.0,100.0],["new",8360.0,20.0],["new",8250.0,70.0],["new",8200.0,16400.0],["new",8185.0,20.0],["new",8156.5,20.0],["new",8150.0,8150.0],["new",8115.5,20.0],["new",8100.0,8100.0],["new",8050.0,8050.0],["new",8026.0,8030.0],["new",8017.0,20000.0],["new",8000.0,8010.0],["new",7950.0,7950.0],["new",7938.0,40.0],["new",7900.0,7900.0],["new",7888.0,150.0],["new",7850.0,15700.0],["new",7800.0,15600.0],["new",7750.0,15500.0],["new",7748.5,20.0],["new",7710.0,10.0],["new",7700.0,15400.0],["new",7681.0,210.0],["new",7650.0,7650.0],["new",7600.0,7600.0],["new",7555.0,10.0],["new",7535.5,20.0],["new",7501.5,10.0],["new",7500.0,10000.0],["new",7400.0,7400.0],["new",7300.0,7300.0],["new",7295.0,20.0],["new",7100.0,7100.0],["new",7054.5,20.0],["new",7050.0,7050.0],["new",7017.0,30000.0],["new",7000.0,10530.0],["new",6100.0,61000.0],["new",6017.0,40000.0],["new",6001.0,10.0],["new",6000.0,6010.0],["new",5900.0,5900.0],["new",5850.0,5850.0],["new",5800.0,5800.0],["new",5750.0,17250.0],["new",5700.0,5700.0],["new",5683.0,200.0],["new",5650.0,5650.0],["new",5600.0,5600.0],["new",5555.0,10.0],["new",5550.0,5550.0],["new",5500.0,5500.0],["new",5450.0,5450.0],["new",5400.0,5400.0],["new",5350.0,5350.0],["new",5300.0,5300.0],["new",5250.0,5250.0],["new",5200.0,5200.0],["new",5150.0,5150.0],["new",5100.0,56100.0],["new",5088.0,300.0],["new",5050.0,5050.0],["new",5000.0,5000.0],["new",4950.0,4950.0],["new",4900.0,4900.0],["new",4850.0,4850.0],["new",4800.0,4800.0],["new",4750.0,4750.0],["new",4700.0,4700.0],["new",4650.0,4650.0],["new",4600.0,4600.0],["new",4500.0,4500.0],["new",4450.0,4450.0],["new",4400.0,4400.0],["new",4300.0,4300.0],["new",4200.0,4200.0],["new",4150.0,75000.0],["new",4100.0,4100.0],["new",4026.0,8050.0],["new",4025.0,6500.0],["new",3670.0,10.0],["new",3600.0,36000.0],["new",3501.5,10.0],["new",3058.0,40.0],["new",2501.5,10.0],["new",2001.5,10.0],["new",1000.0,250.0]],"asks":[["new",23920.5,76900.0],["new",23921.5,30.0],["new",23922.5,30.0],["new",23925.0,510.0],["new",23925.5,1000.0],["new",23926.0,5040.0],["new",23926.5,10.0],["new",23927.0,40.0],["new",23927.5,700.0],["new",23928.0,1460.0],["new",23928.5,88250.0],["new",23929.0,30.0],["new",23929.5,60.0],["new",23930.0,20.0],["new",23930.5,35360.0],["new",23931.0,67310.0],["new",23931.5,10.0],["new",23932.0,520.0],["new",23932.5,48020.0],["new",23933.5,6000.0],["new",23935.0,770.0],["new",23936.0,30000.0],["new",23936.5,4740.0],["new",23937.0,3000.0],["new",23937.5,5000.0],["new",23939.0,21190.0],["new",23939.5,1000.0],["new",23940.5,3300.0],["new",23941.0,222780.0],["new",23941.5,560.0],["new",23942.0,315530.0],["new",23942.5,11970.0],["new",23943.0,16860.0],["new",23943.5,16760.0],["new",23944.0,17760.0],["new",23944.5,153500.0],["new",23945.0,23760.0],["new",23945.5,50000.0],["new",23946.0,30120.0],["new",23946.5,1000.0],["new",23947.5,1670.0],["new",23948.0,2300.0],["new",23949.0,2150.0],["new",23949.5,299230.0],["new",23950.5,26460.0],["new",23951.0,26000.0],["new",23951.5,21220.0],["new",23952.0,2000.0],["new",23953.0,7380.0],["new",23953.5,32250.0],["new",23954.0,195490.0],["new",23954.5,397040.0],["new",23955.0,14370.0],["new",23956.0,3330.0],["new",23956.5,3440.0],["new",23957.5,2000.0],["new",23958.0,10.0],["new",23958.5,600010.0],["new",23959.0,8300.0],["new",23961.0,150.0],["new",23961.5,30000.0],["new",23962.0,1500.0],["new",23962.5,32480.0],["new",23963.0,13280.0],["new",23963.5,281580.0],["new",23964.5,26000.0],["new",23966.0,250000.0],["new",23966.5,3040.0],["new",23968.5,10.0],["new",23969.0,74480.0],["new",23971.0,16750.0],["new",23972.0,1500.0],["new",23972.5,651360.0],["new",23973.0,2250.0],["new",23974.5,24890.0],["new",23979.0,7120.0],["new",23981.0,40970.0],["new",23981.5,1510.0],["new",23982.5,10.0],["new",23985.0,10.0],["new",23985.5,434510.0],["new",23986.0,1510.0],["new",23986.5,20.0],["new",23987.0,10.0],["new",23987.5,30.0],["new",23988.0,10.0],["new",23988.5,10.0],["new",23989.5,20.0],["new",23990.0,240.0],["new",23990.5,95610.0],["new",23991.0,134980.0],["new",23992.5,10.0],["new",23995.5,13290.0],["new",23996.0,8360.0],["new",23997.5,700580.0],["new",23998.0,10.0],["new",24000.0,210.0],["new",24000.5,10.0],["new",24001.5,30.0],["new",24004.0,359730.0],["new",24005.0,102080.0],["new",24013.5,13280.0],["new",24019.0,500.0],["new",24020.0,190.0],["new",24025.5,7330.0],["new",24027.5,138030.0],["new",24030.5,228890.0],["new",24032.5,38490.0],["new",24037.0,13280.0],["new",24041.0,1000000.0],["new",24043.5,10.0],["new",24045.0,240.0],["new",24047.0,8300.0],["new",24057.5,2000.0],["new",24058.0,38490.0],["new",24060.5,211190.0],["new",24062.0,80.0],["new",24062.5,347380.0],["new",24077.0,5000.0],["new",24079.0,500.0],["new",24080.5,280.0],["new",24081.0,1000.0],["new",24081.5,240.0],["new",24083.0,50.0],["new",24099.0,8300.0],["new",24100.0,240.0],["new",24140.0,81990.0],["new",24155.0,240.0],["new",24159.0,8300.0],["new",24159.5,1000.0],["new",24182.0,56000.0],["new",24185.0,20.0],["new",24194.0,138190.0],["new",24195.0,10000.0],["new",24199.5,114800.0],["new",24200.0,6260.0],["new",24210.0,240.0],["new",24211.0,10000.0],["new",24225.0,30.0],["new",24227.0,8750.0],["new",24231.5,80.0],["new",24232.0,38490.0],["new",24233.0,10.0],["new",24239.5,130.0],["new",24240.0,10000.0],["new",24248.0,300000.0],["new",24257.5,7040.0],["new",24259.0,20.0],["new",24260.0,10190.0],["new",24261.5,500.0],["new",24265.0,240.0],["new",24266.0,8300.0],["new",24270.5,80.0],["new",24273.0,140.0],["new",24277.0,450.0],["new",24285.0,10000.0],["new",24288.0,1290.0],["new",24290.0,7770.0],["new",24291.5,10.0],["new",24300.0,21740.0],["new",24308.0,289370.0],["new",24308.5,50000.0],["new",24310.0,7770.0],["new",24320.0,240.0],["new",24322.0,8300.0],["new",24334.5,35940.0],["new",24336.0,210.0],["new",24338.0,120.0],["new",24340.0,420.0],["new",24345.0,10.0],["new",24358.0,8300.0],["new",24370.0,30000.0],["new",24373.0,2370.0],["new",24375.0,10240.0],["new",24379.0,50.0],["new",24380.0,7960.0],["new",24383.5,10.0],["new",24384.0,71840.0],["new",24390.0,40.0],["new",24394.0,8900.0],["new",24395.0,500.0],["new",24400.0,810.0],["new",24407.0,136870.0],["new",24420.0,8300.0],["new",24430.0,240.0],["new",24431.0,1000.0],["new",24437.0,5940.0],["new",24440.0,7770.0],["new",24450.0,500.0],["new",24454.5,5930.0],["new",24472.5,5930.0],["new",24473.0,175440.0],["new",24477.0,24380.0],["new",24479.0,10000.0],["new",24480.0,600.0],["new",24481.0,10.0],["new",24485.0,340.0],["new",24488.0,1230.0],["new",24490.5,5930.0],["new",24497.0,100.0],["new",24499.0,2000.0],["new",24500.0,34030.0],["new",24509.0,5930.0],["new",24520.0,16070.0],["new",24527.0,5930.0],["new",24538.0,25000.0],["new",24540.0,240.0],["new",24546.0,5930.0],["new",24555.0,20000.0],["new",24559.0,600.0],["new",24560.0,7770.0],["new",24565.0,5930.0],["new",24577.0,24380.0],["new",24584.0,5930.0],["new",24590.0,7770.0],["new",24595.0,240.0],["new",24600.0,200.0],["new",24603.5,5930.0],["new",24609.5,177070.0],["new",24620.0,8490.0],["new",24630.0,7770.0],["new",24634.0,600.0],["new",24640.0,210250.0],["new",24649.5,250.0],["new",24650.0,10240.0],["new",24652.0,120.0],["new",24653.5,25000.0],["new",24670.0,7770.0],["new",24671.0,1000.0],["new",24677.0,24380.0],["new",24688.0,500000.0],["new",24700.0,7770.0],["new",24710.0,7770.0],["new",24716.5,100.0],["new",24721.5,600.0],["new",24737.0,2000.0],["new",24740.0,190.0],["new",24744.0,50000.0],["new",24750.0,10000.0],["new",24754.0,3510.0],["new",24765.0,10000.0],["new",24777.0,25080.0],["new",24791.5,600.0],["new",24795.0,3000.0],["new",24799.0,10.0],["new",24802.5,500.0],["new",24818.0,1000.0],["new",24850.0,4970.0],["new",24855.0,110.0],["new",24860.0,190.0],["new",24874.0,30.0],["new",24875.0,600.0],["new",24877.0,24380.0],["new",24881.5,500.0],["new",24888.0,250.0],["new",24895.0,20000.0],["new",24900.0,2500.0],["new",24910.0,180.0],["new",24922.5,10000.0],["new",24950.0,13080.0],["new",24974.5,150.0],["new",24977.0,24380.0],["new",24980.0,190.0],["new",24984.0,3000.0],["new",24990.0,180.0],["new",24996.0,25000.0],["new",24999.0,2200.0],["new",25000.0,65900.0],["new",25028.0,600.0],["new",25037.0,1000.0],["new",25077.0,49950.0],["new",25091.5,100.0],["new",25100.0,35400.0],["new",25107.0,600.0],["new",25133.0,1000.0],["new",25133.5,1000.0],["new",25137.0,20.0],["new",25143.5,12300.0],["new",25147.0,27500.0],["new",25164.5,3550.0],["new",25167.0,10.0],["new",25177.0,49950.0],["new",25194.5,2600.0],["new",25200.0,30.0],["new",25210.0,10.0],["new",25238.0,2500.0],["new",25266.5,600.0],["new",25277.0,49950.0],["new",25300.0,200.0],["new",25307.0,2500.0],["new",25325.0,10030.0],["new",25331.5,600.0],["new",25363.0,10.0],["new",25363.5,3550.0],["new",25377.0,49950.0],["new",25382.5,5700.0],["new",25385.5,23190.0],["new",25386.0,110.0],["new",25389.0,20.0],["new",25392.0,2270.0],["new",25400.0,200.0],["new",25413.0,200.0],["new",25438.0,250.0],["new",25449.0,100.0],["new",25467.0,110.0],["new",25477.0,49950.0],["new",25481.0,40.0],["new",25499.0,2000.0],["new",25500.0,200.0],["new",25537.0,1800.0],["new",25557.0,20.0],["new",25570.0,3550.0],["new",25577.0,49950.0],["new",25588.0,250.0],["new",25600.0,500.0],["new",25622.0,3250.0],["new",25627.0,55000.0],["new",25628.0,1800.0],["new",25639.5,50000.0],["new",25666.0,3000.0],["new",25674.5,20.0],["new",25677.0,49950.0],["new",25700.0,5400.0],["new",25741.0,3550.0],["new",25777.0,49950.0],["new",25800.0,200.0],["new",25877.0,49950.0],["new",25888.0,1290.0],["new",25929.5,3550.0],["new",25932.5,13000.0],["new",25933.0,2620.0],["new",25941.5,200.0],["new",25970.0,10000.0],["new",25974.0,500.0],["new",25977.0,49950.0],["new",25995.5,100.0],["new",25999.0,2200.0],["new",26000.0,12700.0],["new",26024.0,1100.0],["new",26055.0,900.0],["new",26070.0,30.0],["new",26077.0,52150.0],["new",26103.5,3550.0],["new",26107.0,1000.0],["new",26108.0,30.0],["new",26118.0,1100.0],["new",26150.0,150000.0],["new",26177.0,52150.0],["new",26188.0,1320.0],["new",26190.0,5500.0],["new",26196.5,250.0],["new",26200.0,400.0],["new",26204.5,30.0],["new",26210.0,10.0],["new",26241.0,20.0],["new",26262.0,3550.0],["new",26277.0,52150.0],["new",26288.0,250.0],["new",26290.0,2330.0],["new",26319.5,50000.0],["new",26332.0,30.0],["new",26335.0,2800.0],["new",26336.5,76000.0],["new",26365.0,26500.0],["new",26377.0,52150.0],["new",26388.0,1320.0],["new",26439.0,3550.0],["new",26449.0,100.0],["new",26476.5,30.0],["new",26477.0,65390.0],["new",26487.0,30.0],["new",26499.0,1500.0],["new",26515.5,250.0],["new",26577.0,52150.0],["new",26600.0,200.0],["new",26600.5,3550.0],["new",26650.0,10000.0],["new",26677.0,52150.0],["new",26737.0,30.0],["new",26777.0,52150.0],["new",26832.0,2500.0],["new",26848.0,3000.0],["new",26876.0,30.0],["new",26877.0,52150.0],["new",26881.5,2500.0],["new",26900.0,1000.0],["new",26937.0,13470.0],["new",26967.0,11000.0],["new",26977.0,52150.0],["new",26988.0,250.0],["new",26999.0,1700.0],["new",27000.0,1700.0],["new",27077.0,54150.0],["new",27097.0,1000.0],["new",27100.0,75000.0],["new",27107.0,30.0],["new",27177.0,54150.0],["new",27266.0,4540.0],["new",27277.0,54150.0],["new",27293.0,10000.0],["new",27325.0,10000.0],["new",27333.0,13670.0],["new",27377.0,54150.0],["new",27393.0,30.0],["new",27400.0,10200.0],["new",27422.0,1000.0],["new",27431.0,1000.0],["new",27449.0,100.0],["new",27477.0,54750.0],["new",27499.0,1500.0],["new",27500.0,60000.0],["new",27564.0,30.0],["new",27577.0,54750.0],["new",27600.0,10000.0],["new",27672.0,1500.0],["new",27677.0,54750.0],["new",27679.0,10.0],["new",27700.0,18000.0],["new",27750.0,1000000.0],["new",27777.0,54750.0],["new",27800.0,457890.0],["new",27811.0,1000.0],["new",27833.0,13920.0],["new",27877.0,54750.0],["new",27884.0,5000.0],["new",27900.0,10000.0],["new",27950.0,10000.0],["new",27964.0,3220.0],["new",27975.0,200.0],["new",27977.0,54750.0],["new",27980.0,30000.0],["new",27999.0,1700.0],["new",28000.0,1008700.0],["new",28061.0,1000.0],["new",28077.0,54750.0],["new",28100.0,113100.0],["new",28177.0,68840.0],["new",28200.0,28200.0],["new",28240.0,30.0],["new",28250.0,1000000.0],["new",28271.0,1000.0],["new",28277.0,54750.0],["new",28300.0,28300.0],["new",28377.0,56750.0],["new",28400.0,28400.0],["new",28449.0,100.0],["new",28477.0,56750.0],["new",28482.0,30.0],["new",28488.0,1420.0],["new",28499.0,1500.0],["new",28500.0,1000000.0],["new",28537.0,1000.0],["new",28550.0,2760.0],["new",28557.0,100.0],["new",28577.0,56750.0],["new",28650.0,2010.0],["new",28677.0,56750.0],["new",28688.0,1430.0],["new",28694.0,1000.0],["new",28737.0,14370.0],["new",28743.0,10.0],["new",28750.0,1000000.0],["new",28777.0,56750.0],["new",28846.0,140.0],["new",28869.5,200000.0],["new",28877.0,56750.0],["new",28888.0,100000.0],["new",28896.0,1000.0],["new",28900.0,250.0],["new",28977.0,56750.0],["new",28988.0,1450.0],["new",28997.0,450.0],["new",28999.0,1700.0],["new",29000.0,1002200.0],["new",29077.0,56750.0],["new",29100.0,75000.0],["new",29175.0,1000.0],["new",29177.0,58350.0],["new",29188.0,1460.0],["new",29250.0,1000000.0],["new",29271.0,1000.0],["new",29277.0,58350.0],["new",29367.0,1000.0],["new",29377.0,58350.0],["new",29399.0,2000.0],["new",29406.5,9500.0],["new",29440.5,15000.0],["new",29449.0,100.0],["new",29477.0,58350.0],["new",29488.0,100000.0],["new",29497.0,1000.0],["new",29499.0,1500.0],["new",29500.0,1000000.0],["new",29551.0,100.0],["new",29577.0,58350.0],["new",29600.0,15000.0],["new",29677.0,58350.0],["new",29704.0,1000.0],["new",29729.0,1000.0],["new",29744.0,100000.0],["new",29750.0,1000000.0],["new",29777.0,58350.0],["new",29781.5,5000.0],["new",29800.0,1000.0],["new",29817.5,100000.0],["new",29867.0,1000.0],["new",29877.0,58350.0],["new",29888.0,100000.0],["new",29903.0,1000.0],["new",29910.0,1000.0],["new",29977.0,62350.0],["new",29998.0,1000.0],["new",29999.0,2100.0],["new",30000.0,1001900.0],["new",30077.0,60150.0],["new",30144.0,200000.0],["new",30177.0,60150.0],["new",30178.0,1000.0],["new",30200.0,300.0],["new",30237.0,1000.0],["new",30277.0,60150.0],["new",30300.0,3000.0],["new",30377.0,60150.0],["new",30456.0,100.0],["new",30457.0,1000.0],["new",30477.0,60150.0],["new",30499.0,1500.0],["new",30527.0,1000.0],["new",30577.0,60150.0],["new",30608.0,3000.0],["new",30614.0,1000.0],["new",30677.0,60150.0],["new",30713.0,1000.0],["new",30777.0,60150.0],["new",30781.5,5000.0],["new",30877.0,60150.0],["new",30892.0,163500.0],["new",30900.0,3000.0],["new",30913.0,1000.0],["new",30919.5,1010.0],["new",30977.0,60150.0],["new",30999.0,1500.0],["new",31000.0,200.0],["new",31050.0,4300.0],["new",31077.0,60150.0],["new",31099.5,1010.0],["new",31168.5,1010.0],["new",31177.0,60150.0],["new",31270.0,100.0],["new",31277.0,60150.0],["new",31377.0,60150.0],["new",31435.5,90.0],["new",31477.0,60150.0],["new",31488.0,1570.0],["new",31499.0,1500.0],["new",31577.0,60150.0],["new",31624.0,1000.0],["new",31677.0,60150.0],["new",31688.0,1580.0],["new",31731.0,1000.0],["new",31777.0,60150.0],["new",31877.0,60150.0],["new",31900.0,50.0],["new",31903.0,100.0],["new",31904.0,163500.0],["new",31931.0,1000.0],["new",31977.0,60150.0],["new",31999.0,1500.0],["new",32000.0,15200.0],["new",32005.0,8000.0],["new",32131.0,1000.0],["new",32200.0,1000000.0],["new",32236.0,100.0],["new",32264.0,4500.0],["new",32331.0,1000.0],["new",32340.5,2000.0],["new",32400.0,1000000.0],["new",32431.0,1000.0],["new",32450.0,2000.0],["new",32499.0,1500.0],["new",32571.5,250.0],["new",32588.0,1630.0],["new",32600.0,1000000.0],["new",32631.0,1000.0],["new",32688.0,1620.0],["new",32788.0,1640.0],["new",32800.0,1000000.0],["new",32875.0,163500.0],["new",32903.5,5100.0],["new",32966.0,100.0],["new",32988.0,1650.0],["new",32999.0,1500.0],["new",33000.0,1200360.0],["new",33022.0,990.0],["new",33200.0,1000000.0],["new",33288.0,1660.0],["new",33315.0,3000.0],["new",33400.0,1000000.0],["new",33488.0,1670.0],["new",33499.0,1500.0],["new",33500.0,20000.0],["new",33600.0,1000000.0],["new",33621.0,100.0],["new",33631.0,1000.0],["new",33688.0,1680.0],["new",33800.0,1067600.0],["new",33888.0,1690.0],["new",33968.5,100.0],["new",33999.0,1500.0],["new",34000.0,1000100.0],["new",34088.0,1700.0],["new",34092.0,1190.0],["new",34150.0,200000.0],["new",34171.0,100.0],["new",34200.0,1000000.0],["new",34222.0,200000.0],["new",34351.5,4000.0],["new",34388.0,1720.0],["new",34400.0,1000000.0],["new",34499.0,1500.0],["new",34507.5,50.0],["new",34600.0,1000000.0],["new",34761.0,5200.0],["new",34796.5,220000.0],["new",34800.0,1000000.0],["new",34844.0,200000.0],["new",35000.0,1211650.0],["new",35009.5,4500.0],["new",35024.5,100.0],["new",35100.0,100.0],["new",35143.0,15000.0],["new",35148.0,100.0],["new",35188.0,1760.0],["new",35200.0,1000000.0],["new",35388.0,1770.0],["new",35399.0,6000.0],["new",35400.0,1120000.0],["new",35444.0,200000.0],["new",35588.0,1780.0],["new",35600.0,1035600.0],["new",35683.5,1500.0],["new",35714.0,100.0],["new",35765.0,7470.0],["new",35777.0,6000.0],["new",35788.0,1790.0],["new",35800.0,1035800.0],["new",35884.5,20.0],["new",35888.0,4000.0],["new",35988.0,1800.0],["new",36000.0,1000100.0],["new",36092.0,100.0],["new",36200.0,1000000.0],["new",36208.5,250.0],["new",36343.0,100.0],["new",36388.0,1820.0],["new",36398.0,3610.0],["new",36400.0,1000000.0],["new",36473.0,150000.0],["new",36600.0,1000000.0],["new",36659.0,8000.0],["new",36800.0,1000000.0],["new",37000.0,1000150.0],["new",37177.0,500.0],["new",37188.0,500.0],["new",37200.0,1000000.0],["new",37222.0,500.0],["new",37294.0,100.0],["new",37333.0,250.0],["new",37400.0,1000000.0],["new",37498.5,150000.0],["new",37600.0,1000000.0],["new",37665.0,100.0],["new",37700.0,18850.0],["new",37800.0,1000000.0],["new",37923.0,1000.0],["new",38000.0,1000100.0],["new",38200.0,1000000.0],["new",38400.0,1000000.0],["new",38524.0,2000.0],["new",38568.0,150000.0],["new",38590.0,100.0],["new",38600.0,1000000.0],["new",38645.0,3300.0],["new",38726.0,90000.0],["new",38789.0,100.0],["new",38800.0,1000000.0],["new",39000.0,1000100.0],["new",39177.0,150000.0],["new",39200.0,1000000.0],["new",39400.0,1000000.0],["new",39453.0,100.0],["new",39490.0,39490.0],["new",39521.0,2000.0],["new",39550.0,50.0],["new",39600.0,1000000.0],["new",39800.0,1000000.0],["new",39818.0,100.0],["new",39934.0,3000.0],["new",40000.0,1000100.0],["new",40150.0,50000.0],["new",40335.5,1500.0],["new",40343.5,2000.0],["new",40500.0,1500.0],["new",40620.0,150000.0],["new",40760.0,50.0],["new",40843.0,100.0],["new",40950.0,1500.0],["new",41000.0,81500.0],["new",41008.5,160.0],["new",41023.0,550.0],["new",41033.5,2820.0],["new",41405.0,100.0],["new",41450.0,1500.0],["new",41950.0,50.0],["new",42000.0,100.0],["new",42141.0,2100.0],["new",42465.0,100.0],["new",42743.5,250.0],["new",42769.0,3000.0],["new",42850.0,150000.0],["new",43000.0,100.0],["new",43075.0,100000.0],["new",43118.0,100.0],["new",43290.0,37490.0],["new",43399.5,37500.0],["new",43425.5,37500.0],["new",43513.0,1000.0],["new",43933.0,100.0],["new",43950.0,50.0],["new",44000.0,100.0],["new",44506.0,12000.0],["new",44701.0,1000.0],["new",44750.0,2000.0],["new",45000.0,200.0],["new",45257.0,4000.0],["new",45500.0,50.0],["new",45646.0,100.0],["new",45911.0,1720.0],["new",46000.0,480.0],["new",46020.0,110000.0],["new",46317.0,550.0],["new",46417.0,3000.0],["new",46500.0,4420.0],["new",46788.0,100.0],["new",47000.0,100.0],["new",47700.0,2000.0],["new",47750.0,50.0],["new",47922.0,1000.0],["new",48000.0,100.0],["new",48150.0,100.0],["new",48470.0,250.0],["new",48922.0,2000.0],["new",49000.0,100100.0],["new",49862.0,100.0],["new",49922.0,2000.0],["new",50000.0,100.0],["new",50250.0,150.0],["new",50550.0,50.0],["new",50800.0,100.0],["new",50839.5,5530.0],["new",51000.0,100.0],["new",51065.5,50520.0],["new",51500.0,20000.0],["new",51700.0,100.0],["new",52000.0,41990.0],["new",52785.0,15840.0],["new",52825.0,100.0],["new",52900.0,1000.0],["new",52937.0,150000.0],["new",53000.0,100.0],["new",53200.0,60000.0],["new",53700.0,100.0],["new",53780.0,268910.0],["new",53785.0,16140.0],["new",54000.0,100.0],["new",54878.5,250.0],["new",55000.0,100100.0],["new",55507.0,100.0],["new",55544.0,4000.0],["new",56000.0,100.0],["new",56200.0,3000.0],["new",56489.0,80.0],["new",56540.0,100.0],["new",57000.0,100.0],["new",57197.0,70.0],["new",57750.0,100.0],["new",57777.0,70.0],["new",57966.0,2000.0],["new",58000.0,100.0],["new",58552.0,120.0],["new",59000.0,100.0],["new",59189.0,17760.0],["new",59900.0,3000.0],["new",60000.0,10200.0],["new",60700.0,20000.0],["new",61000.0,20240.0],["new",61344.0,5000.0],["new",61507.0,100.0],["new",62000.0,27100.0],["new",62334.0,2000.0],["new",62544.0,100.0],["new",62864.5,10.0],["new",63000.0,100.0],["new",63550.0,317760.0],["new",63977.0,3000.0],["new",64000.0,100.0],["new",64567.0,3000.0],["new",64779.0,860.0],["new",64800.0,100.0],["new",65000.0,100.0],["new",65200.0,128610.0],["new",65569.0,327860.0],["new",66000.0,100.0],["new",67000.0,100.0],["new",67170.0,100.0],["new",67361.0,18920.0],["new",68500.0,30000.0],["new",68918.0,10.0],["new",68948.0,10.0],["new",68998.0,10.0],["new",69420.0,100.0],["new",69999.0,700.0],["new",70000.0,125000.0],["new",72615.0,5000.0],["new",90342.0,7130.0],["new",90356.0,410.0],["new",100000.0,100000.0],["new",123916.0,600.0]]}}}
{"jsonrpc":"2.0","method":"subscription","params":{"channel":"book.BTC-PERPETUAL.100ms","data":{"type":"change","timestamp":1659142226203,"prev_change_id":48177633129,"instrument_name":"BTC-PERPETUAL","change_id":48177633299,"bids":[["change",23919.5,1100.0],["change",23919.0,10.0],["delete",23917.0,0.0],["new",23916.0,300.0],["change",23915.5,990.0],["change",23915.0,23650.0],["change",23914.5,17230.0],["change",23910.0,8350.0],["change",23907.5,3790.0],["change",23906.5,2570.0],["new",23906.0,100.0],["change",23905.5,85050.0],["change",23904.5,13000.0],["change",23889.5,34330.0],["change",23889.0,12000.0],["change",23562.5,2000.0],["change",23562.0,280790.0],["delete",11961.5,0.0],["new",11960.0,40.0]],"asks":[["change",23920.5,40800.0],["new",23923.5,5010.0],["delete",23925.5,0.0],["change",23926.0,4030.0],["change",23928.0,3460.0],["change",23928.5,84250.0],["change",23929.0,30.0],["change",23929.5,30060.0],["change",23930.0,50020.0],["change",23930.5,4860.0],["change",23931.0,4030.0],["change",23932.0,1620.0],["new",23935.5,4690.0],["change",23936.0,34500.0],["change",23937.0,23970.0],["delete",23939.0,0.0],["change",23939.5,6000.0],["change",23942.0,315630.0],["change",23942.5,11970.0],["change",23943.0,16760.0],["change",23950.5,21770.0],["change",23962.5,32890.0],["new",35881.0,50.0],["delete",35884.5,0.0]]}}}
 */

#[derive(Serialize, Deserialize)]
enum AskBidValue {
    Action(String),
    PriceAmount(f64),
}

#[derive(Serialize, Deserialize)]
#[serde(tag = "type")]
enum SubscriptionData {
    #[serde(rename = "snapshot")]
    Snapshot {
        asks: Vec<Vec<AskBidValue>>,
        bids: Vec<Vec<AskBidValue>>,
    },
    #[serde(rename = "update")]
    Update {
        asks: Vec<Vec<AskBidValue>>,
        bids: Vec<Vec<AskBidValue>>,
    },
}

#[derive(Serialize, Deserialize)]
struct SubscriptionParams {
    channel: String,
    data: SubscriptionData,
}

#[derive(Serialize, Deserialize)]
#[serde(tag = "method")]
enum WebsocketMethod {
    #[serde(rename = "subscription")]
    Subscription { params: SubscriptionParams },
}

#[derive(Serialize, Deserialize)]
#[serde(untagged)]
enum WebsocketResponse {
    Method(WebsocketMethod),
    Response { result: Vec<String> },
}

pub async fn consume_orderbook(sender: UnboundedSender<Operation>) -> Result<(), DeribitError> {
    let connect_addr = "wss://www.deribit.com/ws/api/v2/".to_string();
    let url = Url::parse(&connect_addr).map_err(DeribitError::UrlParse)?;

    let (ws_stream, _) = connect_async(url).await.
        map_err(DeribitError::WSConnect)?;
    println!("WebSocket handshake has been successfully completed");

    let (mut write, read) = ws_stream.split();
    write.send(Message::Text(
        r#"{"jsonrpc": "2.0","method":"public/subscribe","id":4200,"params":{"channels":["book.BTC-PERPETUAL.100ms"]}}"#.to_string())
    ).await.map_err(DeribitError::WSSend)?;

    read.for_each(|message| async {
        let data = message.unwrap().into_data();
        tokio::io::stdout().write_all(&data).await.unwrap();
        tokio::io::stdout().write_all(format!("\n").as_bytes()).await.unwrap();
        // let okx_parse: serde_json::Result<WebsocketResponse> = serde_json::from_slice(
        //     &message.unwrap().into_data(),
        // );
        // match okx_parse {
        //     Ok(resp) => {
        //         match resp {
        //             WebsocketResponse::Action(action) => {
        //                 sender.send(action.try_into().ok().unwrap()).ok().unwrap();
        //             }
        //             WebsocketResponse::Response { event } => {
        //                 tokio::io::stdout().write_all(
        //                     format!("Got event {:?}\n", event).as_bytes(),
        //                 ).await.unwrap();
        //             }
        //         }
        //     }
        //     Err(err) => {
        //         tokio::io::stdout().write_all(
        //             format!("Got parse error {:?}\n", err).as_bytes(),
        //         ).await.unwrap();
        //     }
        // }
    }).await;

    Ok(())
}

mod test {
    use crate::deribit::WebsocketResponse;

    #[test]
    fn should_parse_a_subscribe_response() {
        // Given
        let msg = r#"{"jsonrpc":"2.0","id":4200,"result":["book.BTC-PERPETUAL.100ms"],"usIn":1659142226076321,"usOut":1659142226076499,"usDiff":178,"testnet":false}"#;

        // When
        let resp: WebsocketResponse = serde_json::from_str(msg).unwrap();

        // Then
        if let WebsocketResponse::Response { result } = resp {
            assert_eq!("book.BTC-PERPETUAL.100ms", result[0]);
        } else {
            assert!(false, "not a subscribe");
        }
    }

    #[test]
    fn should_parse_a_subscribe_response_snapshot() {}
}
